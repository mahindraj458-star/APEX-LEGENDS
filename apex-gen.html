<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Garage // Sunlight Protocol</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00f2ff; --sun: #fff7e6; }
        body { margin: 0; overflow: hidden; background: #000; color: #fff; font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'Syncopate', sans-serif; }
        canvas { display: block; }
        .ui-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 10; }
        .interactive { pointer-events: auto; }
        .glass { background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .sun-bloom { box-shadow: 0 0 60px 20px rgba(255, 247, 230, 0.2); }
    </style>
</head>
<body>

    <div class="ui-overlay flex flex-col justify-between p-8 md:p-12">
        <div class="flex justify-between items-start interactive">
            <div>
                <h1 class="text-[10px] font-mono font-bold tracking-[0.5em] text-[#00f2ff]">EXTREME_LUMEN // V.6.0</h1>
                <div class="text-[8px] tracking-[0.2em] text-yellow-400 mt-2 flex items-center gap-2 font-mono">
                    <span class="w-1.5 h-1.5 rounded-full bg-yellow-400 animate-ping"></span>
                    DIRECT_SUNLIGHT_EXPOSURE_ACTIVE
                </div>
            </div>
            
            <div class="flex gap-4">
                <button id="fetch-trigger" class="glass px-6 py-4 rounded text-[9px] font-mono uppercase tracking-widest hover:bg-white/10 transition interactive text-white">Refresh_Lighing</button>
                <button id="view-drive" class="bg-white text-black px-10 py-4 rounded text-[9px] font-mono font-bold uppercase tracking-widest hover:scale-105 transition shadow-2xl interactive">Ignition</button>
            </div>
        </div>

        <div class="flex justify-between items-end">
            <div id="spec-panel" class="w-96 interactive opacity-0 translate-y-4 transition-all duration-700">
                <div class="glass p-8 rounded-2xl border-l-4 border-l-yellow-400 sun-bloom">
                    <div class="mb-10">
                        <span class="text-[8px] text-yellow-400 font-mono uppercase tracking-[0.3em]">Sun-Calibrated Specs</span>
                        <h2 id="active-name" class="font-mono text-2xl tracking-tighter uppercase leading-tight mt-2 text-white">---</h2>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-8 mb-8">
                        <div>
                            <div class="text-[8px] font-mono uppercase text-gray-400 mb-1">Max_Velocity</div>
                            <div id="calc-top-speed" class="text-xl font-mono text-white">000 <span class="text-[10px] text-yellow-500">MPH</span></div>
                        </div>
                        <div>
                            <div class="text-[8px] font-mono uppercase text-gray-400 mb-1">HP_Calculated</div>
                            <div id="val-hp" class="text-xl font-mono text-white">0 <span class="text-[10px] text-yellow-500">HP</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="drive-hud" class="hidden flex flex-col items-center interactive mb-8 mr-8">
                <div class="glass w-48 h-48 rounded-full flex items-center justify-center relative border-b-4 border-yellow-400">
                    <div class="text-center">
                        <div id="speed-val" class="text-5xl font-mono tracking-tighter text-white">000</div>
                        <div class="text-[8px] font-mono text-yellow-400 tracking-[0.3em] mt-1">MPH</div>
                    </div>
                </div>
                <div class="mt-6 flex flex-col items-center gap-2">
                    <div class="text-[8px] font-mono text-white/50 tracking-widest">WASD_DRIVE_PROTOCOL</div>
                    <button id="exit-drive" class="text-[8px] font-mono text-gray-400 hover:text-white uppercase tracking-widest mt-2">PARK_VEHICLE</button>
                </div>
            </div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script>
        let scene, camera, renderer, vehicleGroup, wheels = [];
        let activeCar = null, isDriving = false, currentSpeedMPH = 0, keys = {};
        
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a1a); // Lighter background for sun bounce
            scene.fog = new THREE.Fog(0x1a1a1a, 20, 100);

            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ReinhardToneMapping;
            renderer.toneMappingExposure = 1.2;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // --- INTENSE SUNLIGHT RIG ---
            // Main Sun
            const sunLight = new THREE.DirectionalLight(0xfff7e6, 5.0); 
            sunLight.position.set(10, 50, 10);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 4096;
            sunLight.shadow.mapSize.height = 4096;
            sunLight.shadow.camera.left = -20;
            sunLight.shadow.camera.right = 20;
            sunLight.shadow.camera.top = 20;
            sunLight.shadow.camera.bottom = -20;
            scene.add(sunLight);

            // Fill Light (Sky)
            const skyLight = new THREE.HemisphereLight(0xadd8e6, 0x444444, 2.0); 
            scene.add(skyLight);

            // Overhead High-Intensity Spot (The "Sun Core")
            const topSpot = new THREE.PointLight(0xffffff, 4, 30);
            topSpot.position.set(0, 15, 0);
            scene.add(topSpot);

            // Ground Floor (Polished Chrome Finish)
            const floorGeo = new THREE.PlaneGeometry(2000, 2000);
            const floorMat = new THREE.MeshStandardMaterial({ 
                color: 0x222222, 
                roughness: 0.1, 
                metalness: 0.9 
            });
            const floor = new THREE.Mesh(floorGeo, floorMat);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            const grid = new THREE.GridHelper(200, 100, 0x333333, 0x222222);
            grid.position.y = 0.01;
            scene.add(grid);

            // Initial asset load
            setTimeout(fetchData, 500);
            animate();
        }

        async function fetchData() {
            const carData = {
                name: "HELIOS INTERCEPTOR",
                hp: 1450,
                color: 0xffffff // White body to catch maximum sunlight
            };
            activateCar(carData);
        }

        function activateCar(data) {
            activeCar = data;
            if (vehicleGroup) scene.remove(vehicleGroup);
            
            vehicleGroup = new THREE.Group();
            
            // High Gloss Paint
            const paintMat = new THREE.MeshStandardMaterial({ 
                color: data.color, 
                metalness: 1.0, 
                roughness: 0.0,
                envMapIntensity: 2.0
            });
            
            // Aerodynamic Body
            const body = new THREE.Mesh(new THREE.BoxGeometry(2.3, 0.4, 4.8), paintMat);
            body.position.y = 0.6;
            body.castShadow = true;
            body.receiveShadow = true;
            vehicleGroup.add(body);

            const cabin = new THREE.Mesh(new THREE.BoxGeometry(1.5, 0.5, 2.0), paintMat);
            cabin.position.set(0, 1.0, -0.3);
            cabin.castShadow = true;
            vehicleGroup.add(cabin);

            // Chrome Details
            const chromeMat = new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 1, roughness: 0 });
            const spoiler = new THREE.Mesh(new THREE.BoxGeometry(2.2, 0.1, 0.6), chromeMat);
            spoiler.position.set(0, 1.0, 2.2);
            vehicleGroup.add(spoiler);

            // Wheels
            const wheelGeo = new THREE.CylinderGeometry(0.45, 0.45, 0.4, 32);
            const wheelMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.5 });
            const wheelPos = [[-1.2, 0.45, 1.7], [1.2, 0.45, 1.7], [-1.2, 0.45, -1.7], [1.2, 0.45, -1.7]];
            
            wheels = [];
            wheelPos.forEach(p => {
                const w = new THREE.Mesh(wheelGeo, wheelMat);
                w.rotation.z = Math.PI / 2;
                w.position.set(p[0], p[1], p[2]);
                w.castShadow = true;
                vehicleGroup.add(w);
                wheels.push(w);
            });

            scene.add(vehicleGroup);

            // FORMULA: MPH = 20 * (HP ^ 1/3)
            const topSpeedMPH = Math.round(20 * Math.pow(data.hp, 1/3));
            activeCar.topSpeedLimit = topSpeedMPH;

            // UI Refresh
            const panel = document.getElementById('spec-panel');
            panel.style.opacity = "1";
            panel.style.transform = "translateY(0)";
            document.getElementById('active-name').innerText = data.name;
            document.getElementById('val-hp').innerHTML = `${data.hp} <span class="text-[10px] text-yellow-500">HP</span>`;
            document.getElementById('calc-top-speed').innerHTML = `${topSpeedMPH} <span class="text-[10px] text-yellow-500">MPH</span>`;
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (!isDriving) {
                if (vehicleGroup) vehicleGroup.rotation.y += 0.005;
                camera.position.lerp(new THREE.Vector3(10, 6, 10), 0.05);
                camera.lookAt(0, 0.8, 0);
            } else if (activeCar) {
                const topSpeed = activeCar.topSpeedLimit;
                const accel = (topSpeed / 100) * 0.5;
                
                if (keys.w) currentSpeedMPH += accel;
                else if (keys.s) currentSpeedMPH -= accel * 2;
                else currentSpeedMPH *= 0.99;

                currentSpeedMPH = Math.max(0, Math.min(topSpeed, currentSpeedMPH));
                
                if (keys.a) vehicleGroup.rotation.y += 0.04;
                if (keys.d) vehicleGroup.rotation.y -= 0.04;

                // Move car based on speed
                const moveStep = currentSpeedMPH * 0.006;
                vehicleGroup.translateZ(moveStep);
                wheels.forEach(w => w.rotation.x += moveStep * 4);

                // Chase Cam
                const camOffset = new THREE.Vector3(0, 3, -12).applyMatrix4(vehicleGroup.matrixWorld);
                camera.position.lerp(camOffset, 0.1);
                camera.lookAt(vehicleGroup.position.x, vehicleGroup.position.y + 1, vehicleGroup.position.z);
                
                document.getElementById('speed-val').innerText = Math.round(currentSpeedMPH).toString().padStart(3, '0');
            }
            renderer.render(scene, camera);
        }

        document.getElementById('fetch-trigger').onclick = () => location.reload();
        document.getElementById('view-drive').onclick = () => {
            if (!activeCar) return;
            isDriving = true;
            document.getElementById('spec-panel').style.opacity = "0";
            document.getElementById('drive-hud').classList.remove('hidden');
        };
        document.getElementById('exit-drive').onclick = () => {
            isDriving = false; currentSpeedMPH = 0;
            vehicleGroup.position.set(0,0,0);
            document.getElementById('drive-hud').classList.add('hidden');
            document.getElementById('spec-panel').style.opacity = "1";
        };

        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
        
        init();
    </script>
</body>
</html>
