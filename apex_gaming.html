<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX // MULTI-VEHICLE HANGAR</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Syncopate:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        :root { --apex-red: #ff1111; --apex-cyan: #00f2ff; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Rajdhani', sans-serif; color: #fff; }
        
        /* Loading & Selection Screens */
        .overlay { 
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: radial-gradient(circle at center, #111 0%, #000 100%); 
            z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        
        h1 { font-family: 'Syncopate', sans-serif; color: var(--apex-red); letter-spacing: 8px; margin-bottom: 40px; text-transform: uppercase; text-align: center;}
        
        /* Hangar Grid */
        #hangar-ui { display: none; width: 80%; max-width: 1000px; }
        .vehicle-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; margin-top: 20px; 
        }
        .vehicle-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid #333;
            padding: 20px;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }
        .vehicle-card:hover { 
            background: rgba(255,17,17,0.1); 
            border-color: var(--apex-red);
            transform: translateY(-5px);
        }
        .vehicle-card h3 { font-family: 'Syncopate'; font-size: 1.1rem; margin: 0 0 10px 0; color: var(--apex-cyan); }
        .vehicle-card p { margin: 5px 0; color: #888; font-size: 0.9rem; text-transform: uppercase; }
        
        /* UI HUD Elements */
        #hud { position: absolute; bottom: 30px; left: 30px; pointer-events: none; display: none; z-index: 10; }
        .speed-box { font-size: 5rem; font-family: 'Syncopate'; font-weight: 700; line-height: 1; }
        .speed-box span { font-size: 1.5rem; color: #888; }
        
        #btn-init { 
            padding: 15px 40px; border: 1px solid var(--apex-red); background: transparent; 
            color: #fff; font-family: 'Syncopate'; cursor: pointer; letter-spacing: 2px;
        }
        #btn-init:hover { background: var(--apex-red); color: #000; }
        
        #status-log { margin-top: 20px; color: #555; font-family: monospace; }
    </style>
</head>
<body>

    <!-- Start/Loading Screen -->
    <div id="loader-screen" class="overlay">
        <h1>APEX // SYSTEM</h1>
        <button id="btn-init" onclick="initHangar()">INITIALIZE HANGAR</button>
        <div id="status-log">AWAITING INPUT...</div>
    </div>

    <!-- Selection Screen -->
    <div id="selection-screen" class="overlay" style="display:none;">
        <h1>SELECT VEHICLE</h1>
        <div id="hangar-ui">
            <div class="vehicle-grid" id="vehicleGrid">
                <!-- Cards injected here -->
            </div>
        </div>
    </div>

    <!-- Gameplay HUD -->
    <div id="hud">
        <div class="speed-box" id="speedDisplay">0 <span>MPH</span></div>
        <div id="carInfo" style="color:var(--apex-red); font-family:'Syncopate';">UNIT: --</div>
    </div>

    <script>
        /** * CONFIGURATION
         * Add your .apex filenames here. 
         * Ensure these files are in the same folder on GitHub.
         */
        const VEHICLE_MANIFEST = [
            "car.apex",
            "truck.apex",
            "nano.apex" 
        ];

        let loadedVehicles = [];
        let currentVehicle = null;
        let carMesh = null;
        let speedMph = 0;
        const keys = { w: false, a: false, s: false, d: false };

        // Three.js Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 0.6));
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7);
        scene.add(light);

        const grid = new THREE.GridHelper(2000, 100, 0x333333, 0x111111);
        grid.position.y = -0.01;
        scene.add(grid);

        async function initHangar() {
            const log = document.getElementById('status-log');
            const btn = document.getElementById('btn-init');
            btn.style.display = "none";
            
            log.innerText = "SCANNING REPOSITORY FOR .APEX UNITS...";

            for (const filename of VEHICLE_MANIFEST) {
                try {
                    const response = await fetch(`./${filename}`);
                    if (response.ok) {
                        const data = await response.json();
                        data._filename = filename; // Store filename for reference
                        loadedVehicles.push(data);
                        log.innerText = `FOUND: ${data.metadata.name}`;
                    }
                } catch (e) {
                    console.error("Failed to load " + filename);
                }
            }

            if (loadedVehicles.length === 0) {
                log.innerText = "ERROR: NO .APEX FILES FOUND. CHECK MANIFEST.";
                btn.style.display = "block";
                return;
            }

            renderSelectionGrid();
        }

        function renderSelectionGrid() {
            document.getElementById('loader-screen').style.display = "none";
            document.getElementById('selection-screen').style.display = "flex";
            document.getElementById('hangar-ui').style.display = "block";

            const grid = document.getElementById('vehicleGrid');
            grid.innerHTML = "";

            loadedVehicles.forEach((vehicle, index) => {
                const card = document.createElement('div');
                card.className = "vehicle-card";
                card.onclick = () => selectVehicle(index);
                card.innerHTML = `
                    <h3>${vehicle.metadata.name}</h3>
                    <p>Class: ${vehicle.metadata.type || 'Standard'}</p>
                    <p>Power: ${vehicle.physics.hp} HP</p>
                    <p>Weight: ${vehicle.physics.mass} LBS</p>
                `;
                grid.appendChild(card);
            });
        }

        function selectVehicle(index) {
            currentVehicle = loadedVehicles[index];
            document.getElementById('selection-screen').style.display = "none";
            document.getElementById('hud').style.display = "block";
            document.getElementById('carInfo').innerText = `UNIT: ${currentVehicle.metadata.name}`;
            
            loadModel();
        }

        function loadModel() {
            const loader = new THREE.GLTFLoader();
            if (currentVehicle.modelData) {
                loader.load(currentVehicle.modelData, (gltf) => {
                    carMesh = gltf.scene;
                    scene.add(carMesh);
                    startEngine();
                }, undefined, (err) => {
                    createPlaceholder();
                    startEngine();
                });
            } else {
                createPlaceholder();
                startEngine();
            }
        }

        function createPlaceholder() {
            const geo = new THREE.BoxGeometry(2, 1, 4);
            const mat = new THREE.MeshPhongMaterial({ color: 0x00f2ff, wireframe: true });
            carMesh = new THREE.Mesh(geo, mat);
            carMesh.position.y = 0.5;
            scene.add(carMesh);
        }

        function startEngine() {
            animate();
        }

        // --- Physics & Controls ---
        window.addEventListener('keydown', (e) => { if(keys.hasOwnProperty(e.key.toLowerCase())) keys[e.key.toLowerCase()] = true; });
        window.addEventListener('keyup', (e) => { if(keys.hasOwnProperty(e.key.toLowerCase())) keys[e.key.toLowerCase()] = false; });

        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            if (carMesh && currentVehicle) {
                const p = currentVehicle.physics;
                
                // Simple Physics
                if (keys.w && speedMph < p.topSpeed) speedMph += (p.hp / p.mass) * 50 * delta;
                else speedMph -= 5 * delta;

                if (keys.s) speedMph -= 40 * delta;
                if (speedMph < 0) speedMph = 0;

                if (speedMph > 0) {
                    if (keys.a) carMesh.rotation.y += 1.5 * delta;
                    if (keys.d) carMesh.rotation.y -= 1.5 * delta;
                }

                carMesh.translateZ(-speedMph * 0.5 * delta);
                document.getElementById('speedDisplay').innerHTML = `${Math.floor(speedMph)} <span>MPH</span>`;

                // Follow Camera
                const offset = new THREE.Vector3(0, 3, 10).applyMatrix4(carMesh.matrixWorld);
                camera.position.lerp(offset, 0.1);
                camera.lookAt(carMesh.position);
                
                grid.position.x = carMesh.position.x;
                grid.position.z = carMesh.position.z;
            }

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
